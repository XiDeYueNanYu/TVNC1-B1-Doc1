<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习越南语请联系Wx:XiDeYueNanYu</title>
    <style>
        body {
            background-color: #f7fbf3;
            margin-bottom: 60px;
        }
        #infoBox { 
            width: 100%; 
            max-width: 700px;
            height: 100px; 
            margin: 0 auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        #contactBox { 
            width: 100%; 
            max-width: 700px;
            height: 45px; 
            margin: 0px auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(12px, 2vw, 15px); 
            font-weight: bold;
        }
        .image-frame {
            max-width: 700px;
            margin: 20px auto 0 auto;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none;
            overflow: hidden;
        }
        .image-frame img {
            width: 100%;
            height: auto;
            display: block;
        }
        .content-box {
            max-width: 700px;
            margin: 20px auto;
            padding: 50px;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 30px;
            font-family: Arial;
            color: #222322;
            line-height: 3;
            text-align: justify;
        }
        .translated-word {
            position: relative;
            display: inline-block;
            white-space: nowrap;
            line-height: 1.3;
            background-color: #bfcdbf;
            color: #000000;
            padding: 4px 4px;
            border-radius: 2px;
        }
        .translation {
            position: absolute;
            top: -29px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            background-color: #eddabc;
            color: #313a2d;
            padding: 4px 4px;
            border-radius: 1px;
            white-space: nowrap;
            z-index: 1;
            line-height: 1;
        }
        .original {
            display: inline;
            line-height: 1;
        }
        .floating-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-align: center;
            display: block;
            z-index: 1000;
        }
        #audioPlayer {
            width: 100%;
            margin-bottom: 10px;
        }
        .time-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .time-box-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .floating-controls p#timeDisplay {
            font-size: 28px;
            color: #FFFFFF;
            background-color: #000000;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0;
        }
        .floating-controls .time-box {
            font-size: 16px;
            color: #FFFFFF;
            background-color: #555555;
            padding: 5px 10px;
            border-radius: 5px;
            min-width: 60px;
        }
        .tua-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .control-button {
            width: 50px;
            height: 50px;
            background-color: #363535;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }
        .control-button:disabled {
            background-color: #888888;
            cursor: not-allowed;
        }
        .control-button:hover:not(:disabled) {
            background-color: #000000;
        }
        .pause-play-button {
            background-color: #FF4500;
        }
        .pause-play-button:hover {
            background-color: #CC3700;
        }
        .toggle-button {
            background-color: #4682B4;
        }
        .toggle-button:hover {
            background-color: #36648B;
        }
        .loop-button {
            background-color: #3c923c;
        }
        .loop-button:hover {
            background-color: #347d34;
        }
        .clear-button {
            background-color: #bc3f13;
        }
        .clear-button:hover {
            background-color: #d15124;
        }
        .active {
            background-color: #ffffff; 
            border-radius: 5px;
        }
        #quizContainer {
            display: none;
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            color: #53686f;
            font-size: 25px;
            font-weight: bold;
        }
        .question {
            margin-bottom: 20px;
            padding: 18px;
            color: #53686f;
            border: 5px solid #53686f;
            border-radius: 10px;
            background-color: #ffffff;
            font-size: 20px;
            font-weight: bold;
        }
        .options label {
            display: block;
            margin: 15px 0;
            cursor: pointer;
            color: #21292c;
            font-size: 16px;
            font-weight: bold;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            display: none;
            border: 5px solid #53686f;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            background-color: #ffffff;
            color: #007a33;
        }
        .wrong-answer {
            color: #f65936;
            margin: 10px 0;
            font-size: 16px;
            font-weight: bold;
        }
        #submitQuiz {
            font-family: Arial, sans-serif;
            padding: 10px 20px;
            border: 3px solid #53686f;
            background-color: #FF6820;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        #submitQuiz:hover {
            background-color: #ff844a;
        }
        #vocabContainer {
            display: none;
            max-width: 700px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #vocabControls {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 900px;
            background: #68838B;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            margin-bottom: 10px;
        }
        #vocabControls div {
            margin: 5px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #vocabControls button {
            padding: 8px 8px;
            margin: 0 5px;
            cursor: pointer;
            border: 3px solid #5d757d;
            background: #0f1314;
            color: #fffbef;
            font-size: 28px;
            border-radius: 5px;
        }
        #sentenceNumber {
            width: 50px;
            padding: 10px;
            text-align: center;
            border: 3px solid #68838B;
            background: #FFAD5B;
            color: #000;
            border-radius: 10px;
            font-size: 16px;
            -moz-appearance: textfield;
        }
        #sentenceNumber::-webkit-inner-spin-button, 
        #sentenceNumber::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        #sentenceNumber:disabled {
            background: #eee;
        }
        .disabled {
            cursor: not-allowed;
            pointer-events: none;
        }
        .active-mode {
            border: 4px solid orange;
        }
        #vocabIndicator {
            width: 95%;
            max-width: 700px;
            min-height: 50px;
            margin: 10px auto;
            padding: 5px;
            border: 3px solid #734A2E;
            background: #ffffe0;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #vocabOptionsContainer {
            width: 100%;
            max-width: 700px;
            margin: 10px auto;
        }
        .optionBtn {
            width: 95%;
            max-width: 700px;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #734A2E;
            background: #ffffff;
            color: #000;
            font-size: 30px;
            text-align: left;
            cursor: pointer;
            border-radius: 5px;
        }
        .optionBtn:hover {
            background: #D2E4C4;
        }
        .correct {
            background: #B7D7AA !important;
        }
        .wrong {
            background: #CE6D5E !important;
        }
        .floating-mode-bar {
            position: fixed;
            bottom: 0px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #68838B;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0px 5px rgba(0, 0, 0, 1);
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 1000;
            width: 900px;
        }
        .mode-button {
            padding: 10px 20px;
            border: 0px solid #ccc;
            background: #95a8ad;
            color: #293437;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: border-color 0.3s;
        }
        .mode-button.active {
            border: 2px solid #ffffff;
            background: #f0f0f0;
            color: #293437;
        }
        @media (max-width: 768px) { 
            body {
                margin-bottom: 200px;
            }
            #infoBox { 
                width: 90%; 
                height: 120px; 
                font-size: clamp(30px, 4vw, 40px);
            }
            #contactBox { 
                width: 90%; 
                height: 50px; 
                font-size: clamp(14px, 2vw, 16px);
            }
            .image-frame {
                width: 90%;
                margin: 10px auto 0 auto;
            }
            .content-box {
                margin: 10px auto;
                padding: 20px;
                padding-top: 50px;
                padding-bottom: 90px;
                font-size: 19px;
                line-height: 3.5;
            }
            .translated-word {
                padding: 3px 3px;
            }
            .translation {
                top: -25px;
                font-size: 13px;
            }
            .floating-controls {
                top: 10px;
                right: 10px;
                padding: 5px;
            }
            #vocabControls {
                width: 100%;
                bottom: 50px;
                padding: 5px 0;
            }
            #vocabControls button {
                padding: 6px 6px;
                font-size: 20px;
            }
            #sentenceNumber {
                width: 40px;
                padding: 8px;
                font-size: 14px;
            }
            #vocabIndicator {
                min-height: 40px;
            }
            .optionBtn {
                font-size: 20px;
                padding: 8px;
            }
            .floating-mode-bar {
                width: 100%;
            }
        }
        @media (max-width: 400px) {
            .control-button {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            .floating-controls p#timeDisplay {
                font-size: 20px;
            }
            .floating-controls .time-box {
                font-size: 12px;
                min-width: 50px;
            }
        }
    </style>
</head>
<body>
    <div id="infoBox">习得越南语</div>
    <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
    <div id="contentContainer">
        <div class="image-frame" id="imageFrame">
            <img id="contentImage" src="anhminhhoa.jpg" alt="Content Image">
        </div>
        <div class="content-box" id="content"></div>
    </div>
    <div id="quizContainer">
        <h1>回答下面问题</h1>
        <form id="quizForm">
            <div id="questions"></div>
            <button type="button" id="submitQuiz" onclick="checkAnswers()">提交</button>
        </form>
        <div id="result"></div>
    </div>
    <div id="vocabContainer">
        <div id="vocabIndicator"></div>
        <div id="vocabOptionsContainer"></div>
    </div>
    <div class="floating-controls" id="floatingControls">
        <audio id="audioPlayer" src="lesson.mp3" controls></audio>
        <div class="time-row">
            <p id="timeDisplay">00:00</p>
            <div class="time-box-group">
                <span class="time-box" id="loopStart">--:--</span>
                <span class="time-box" id="loopEnd">--:--</span>
            </div>
            <div class="button-group">
                <button class="control-button loop-button" id="loopButton">听</button>
                <button class="control-button clear-button" id="clearButton">删</button>
            </div>
        </div>
        <div class="tua-buttons">
            <button class="control-button" id="rewind5sButton">-5s</button>
            <button class="control-button" id="rewind1sButton">-1s</button>
            <button class="control-button" id="forward1sButton">+1s</button>
            <button class="control-button" id="forward5sButton">+5s</button>
        </div>
        <div class="action-buttons">
            <button class="control-button pause-play-button" id="pausePlayButton">播</button>
            <button class="control-button toggle-button" id="toggleControlsButton">藏</button>
        </div>
    </div>
    <div id="vocabControls">
        <div>
            <button id="prevBtn">◀</button>
            <input type="text" id="sentenceNumber" inputmode="numeric" pattern="[0-9]*">
            <button id="nextBtn">▶</button>
        </div>
        <div>
            <button id="showHideBtn" class="active-mode">显示-隐藏</button>
            <button id="replayBtn">再听一遍</button>
        </div>
    </div>
    <div class="floating-mode-bar">
        <button class="mode-button active" id="contentMode">内容</button>
        <button class="mode-button" id="quizMode">回答问题</button>
        <button class="mode-button" id="vocabMode">词汇</button>
    </div>

    <audio id="vocabAudio" src="audio.mp3"></audio>
    <audio id="correctAudio" src="Dung.mp3"></audio>
    <audio id="wrongAudio" src="Sai.mp3"></audio>

    <script>

const textContentData = [
    `HƯỚNG DẪN XIN VISA SANG VIỆT NAM
Để có visa sang Việt Nam, bạn có thể xin trực tiếp tại Đại sứ quán (hoặc Lãnh sự quán) Việt Nam tại nước bạn, hoặc liên hệ với trường ở Việt Nam – nơi bạn sẽ đến học tập. Trường sẽ làm thủ tục để bạn được cấp visa.
Trong trường hợp này, bạn cần gửi sang trường ở Việt Nam các giấy tờ sau:
- Một bản lý lịch
- Một bản photo hộ chiếu
- Hai ảnh cỡ 4x6 cm
- Hai đơn xin visa và đơn xin học ở Việt Nam
* Lưu ý: Hộ chiếu của bạn phải còn thời hạn ít nhất 6 tháng.
Bạn cần gửi toàn bộ hồ sơ sang Việt Nam ít nhất 15 ngày trước thời điểm dự định đến.
Sau khi hồ sơ xin cấp visa được gửi đến Cục Xuất nhập cảnh, tại đó họ sẽ đồng ý cấp visa cho bạn. Họ sẽ fax thông tin về visa sang Sứ quán Việt Nam tại nước bạn đang xin visa. Trường học ở Việt Nam sẽ gửi cho bạn số fax đó qua email. Bạn mang số đó đến Sứ quán hoặc Lãnh sự quán nơi bạn đã đăng ký để nhận visa.
Bạn cần tự tìm chỗ ở, hoặc nhờ bạn bè hay trường ở Việt Nam hỗ trợ tìm chỗ ở.
Việc còn lại của bạn là chuẩn bị mọi thứ cần thiết để sang Việt Nam sinh sống và học tập.
Hy vọng bạn sẽ gặp nhiều thuận lợi trong chuyến đi này!`
];
const dictionary = {
    "HƯỚNG DẪN": "指导,说明-[向引]",  
    "visa": "签证",  
    "Việt Nam": "越南",  
    "xin": "申请",  
    "trực tiếp": "直接",  
    "Đại sứ quán": "大使馆",  
    "Lãnh sự quán": "领事馆",  
    "liên hệ": "联系",  
    "trường": "学校",  
    "học tập": "学习",  
    "làm": "办理",  
    "thủ tục": "手续",  
    "cấp": "发, 供给",  
    "trường hợp": "情况",  
    "gửi": "寄送",  
    "giấy tờ": "文件",  
    "bản": "份-[本]",  
    "lý lịch": "履历, 个人简历",  
    "photo": "复印件",  
    "hộ chiếu": "护照",  
    "ảnh": "照片",  
    "cỡ": "尺寸",  
    "đơn": "申请表",  
    "xin visa": "申请签证",  
    "xin học": "申请学习",  
    "lưu ý": "注意",  
    "thời hạn": "期限",  
    "ít nhất": "至少",  
    "ngày": "天",  
    "trước": "之前",  
    "thời điểm": "时间点",  
    "dự định": "预计",  
    "đến": "到达",  
    "hồ sơ": "档案",  
    "Cục Xuất nhập cảnh": "出入境管理局",  
    "đồng ý": "同意",  
    "fax": "传真",  
    "thông tin": "信息",  
    "Sứ quán": "使馆",  
    "số fax": "传真号",  
    "email": "电子邮件",  
    "mang": "携带",  
    "đăng ký": "登记",  
    "nhận": "领取",  
    "tự": "自己",  
    "tìm": "寻找",  
    "chỗ ở": "住宿",  
    "nhờ": "托, 拜托",  
    "bạn bè": "朋友",  
    "hỗ trợ": "帮助-[互助]",  
    "việc": "事情",  
    "còn lại": "剩下",  
    "chuẩn bị": "准备",  
    "mọi thứ": "一切",  
    "cần thiết": "必要",  
    "sinh sống": "生活",  
    "hy vọng": "希望",  
    "gặp": "遇到",  
    "thuận lợi": "顺利",  
    "chuyến đi": "旅程"  
};
const quizData = [
    {
        question: "Theo bài đọc, người xin visa cần gửi hồ sơ đến đâu để được cấp visa?",
        options: ["Bộ Giáo dục và Đào tạo Việt Nam", "Cơ quan Công an tại Việt Nam", "Cục Xuất nhập cảnh Việt Nam", "Đại sứ quán Việt Nam ở nước sở tại"],
        correct: "Cục Xuất nhập cảnh Việt Nam"
    },
    {
        question: "Điều kiện nào bắt buộc đối với hộ chiếu của người xin visa?",
        options: ["Phải có ít nhất 3 trang trắng", "Phải được dịch công chứng sang tiếng Việt", "Phải còn thời hạn tối thiểu 6 tháng", "Phải có visa của nước thứ ba"],
        correct: "Phải còn thời hạn tối thiểu 6 tháng"
    },
    {
        question: "Tại sao cần gửi hồ sơ xin visa ít nhất 15 ngày trước ngày dự định đến Việt Nam?",
        options: ["Để tránh bị trễ học kỳ mới", "Để có thời gian chuẩn bị hành lý", "Vì đó là yêu cầu bắt buộc trong quá trình xét duyệt", "Để trường có thời gian đặt vé máy bay cho sinh viên"],
        correct: "Vì đó là yêu cầu bắt buộc trong quá trình xét duyệt"
    },
    {
        question: "Thông tin nào sau đây đúng về việc nhận visa?",
        options: ["Người xin visa sẽ được gửi visa qua đường bưu điện", "Visa được cấp trực tiếp tại trường học Việt Nam", "Trường học sẽ gửi bản in visa cho người học", "Người xin visa cần đến Đại sứ quán để nhận visa sau khi có số fax"],
        correct: "Người xin visa cần đến Đại sứ quán để nhận visa sau khi có số fax"
    },
    {
        question: "Theo bài, hình thức hỗ trợ nào được trường học ở Việt Nam cung cấp?",
        options: ["Tìm kiếm chỗ ở nếu người học cần", "Trả phí visa cho sinh viên", "Đặt vé máy bay khứ hồi", "Hỗ trợ học phí năm đầu tiên"],
        correct: "Tìm kiếm chỗ ở nếu người học cần"
    },
    {
        question: "Mục đích chính của văn bản trên là gì?",
        options: ["Quảng bá hệ thống giáo dục Việt Nam đến sinh viên nước ngoài", "Hướng dẫn các bước cụ thể để xin visa du lịch Việt Nam", "Giới thiệu những loại hình chỗ ở tại Việt Nam", "Cung cấp quy trình xin visa du học Việt Nam một cách rõ ràng"],
        correct: "Cung cấp quy trình xin visa du học Việt Nam một cách rõ ràng"
    },
    {
        question: "Từ “hồ sơ” trong bài gần nghĩa nhất với từ nào sau đây?",
        options: ["Chứng minh thư", "Giấy tờ cần nộp", "Lý lịch cá nhân", "Sổ hộ khẩu"],
        correct: "Giấy tờ cần nộp"
    },
    {
        question: "Theo bài, yếu tố nào KHÔNG nằm trong bộ hồ sơ xin visa?",
        options: ["Một bản lý lịch", "Một bản sao học bạ", "Hai ảnh cỡ 4x6", "Hai đơn xin visa và đơn xin học"],
        correct: "Một bản sao học bạ"
    },
    {
        question: "Thái độ của tác giả trong đoạn kết của bài là gì?",
        options: ["Trung lập và thông báo", "Mỉa mai và chỉ trích", "Lạc quan và khích lệ", "Lo lắng và thận trọng"],
        correct: "Lạc quan và khích lệ"
    },
    {
        question: "Điều gì xảy ra ngay sau khi Cục Xuất nhập cảnh đồng ý cấp visa?",
        options: ["Visa được gửi về nhà người xin", "Số fax được gửi đến Đại sứ quán Việt Nam", "Người xin visa phải đến trường nộp học phí", "Đại sứ quán gọi điện trực tiếp cho người xin"],
        correct: "Số fax được gửi đến Đại sứ quán Việt Nam"
    },
    {
        question: "Dòng nào sau đây mô tả đúng quy trình cấp visa theo bài?",
        options: ["Trường học → Người học → Cục Xuất nhập cảnh → Đại sứ quán", "Người học → Trường học → Cục Xuất nhập cảnh → Đại sứ quán", "Người học → Đại sứ quán → Trường học → Cục Xuất nhập cảnh", "Trường học → Cục Xuất nhập cảnh → Người học → Đại sứ quán"],
        correct: "Người học → Trường học → Cục Xuất nhập cảnh → Đại sứ quán"
    },
    {
        question: "Cụm từ “việc còn lại của bạn” trong bài có hàm ý gì?",
        options: ["Bạn không cần làm gì thêm", "Từ thời điểm đó, bạn phải tự lo toàn bộ mọi thứ", "Chỉ cần chuẩn bị những điều nhỏ nhặt", "Những bước quan trọng nhất đã hoàn tất, bạn cần chuẩn bị để sang Việt Nam"],
        correct: "Những bước quan trọng nhất đã hoàn tất, bạn cần chuẩn bị để sang Việt Nam"
    }
];
const sentences = [
    {
        "audioFile": "audio.mp3",
        "start": 0.28,
        "end": 1.36,
        "correctAnswer": "hướng dẫn",
        "translation": "指导,说明, 带(做事)-[向引]",
        "options": [
            "hướng dãn",
            "hướng dỡn",
            "hương dẫn",
            "hướng dẫn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 1.55,
        "end": 2.69,
        "correctAnswer": "trực tiếp",
        "translation": "直接",
        "options": [
            "trựt tiếp",
            "trực tiêp",
            "trực tiếp",
            "trúc tiếp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 2.71,
        "end": 4,
        "correctAnswer": "Đại sứ quán",
        "translation": "大使馆",
        "options": [
            "Đại sứ qan",
            "Đai sứ quán",
            "Đại sứ quán",
            "Đại sứ quẩn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 4.17,
        "end": 5.49,
        "correctAnswer": "Lãnh sự quán",
        "translation": "领事馆",
        "options": [
            "Lãnh sụ quán",
            "Lãnh sự quản",
            "Lãnh sự quán",
            "Lãnh sự qúan"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 5.61,
        "end": 6.76,
        "correctAnswer": "liên hệ",
        "translation": "联系",
        "options": [
            "liên hẹ",
            "liền hệ",
            "liên hệ",
            "liêh nệ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 6.8,
        "end": 7.88,
        "correctAnswer": "trường học",
        "translation": "学校",
        "options": [
            "trương học",
            "trườn hok",
            "trươngg học",
            "trường học"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 7.96,
        "end": 9.02,
        "correctAnswer": "học tập",
        "translation": "学习",
        "options": [
            "học tạp",
            "hộc tập",
            "học tập",
            "học tăp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 9.14,
        "end": 10.51,
        "correctAnswer": "làm thủ tục",
        "translation": "办理手续",
        "options": [
            "làm thú tục",
            "làm thủ tục",
            "lăm thú tục",
            "làm thủ túc"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 10.63,
        "end": 11.5,
        "correctAnswer": "cấp",
        "translation": "发, 供给",
        "options": [
            "cáp",
            "cầp",
            "cấp",
            "căp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 11.65,
        "end": 12.76,
        "correctAnswer": "trường hợp",
        "translation": "情况",
        "options": [
            "trương hợp",
            "trường hộp",
            "trương hơp",
            "trường hợp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 12.9,
        "end": 13.85,
        "correctAnswer": "gửi",
        "translation": "寄送",
        "options": [
            "gửi",
            "gưởi",
            "gưi",
            "gưỡi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 13.88,
        "end": 15.06,
        "correctAnswer": "giấy tờ",
        "translation": "文件",
        "options": [
            "giấy tơ",
            "giây tờ",
            "giấy tờ",
            "giầy tờ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 15.26,
        "end": 16.2,
        "correctAnswer": "bản",
        "translation": "份-[本]",
        "options": [
            "bảng",
            "bản",
            "bẳn",
            "bãn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 16.25,
        "end": 17.36,
        "correctAnswer": "lý lịch",
        "translation": "履历, 个人简历",
        "options": [
            "lý lịc",
            "ly lịch",
            "lý lịch",
            "lí lịch"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 17.49,
        "end": 18.6,
        "correctAnswer": "photo",
        "translation": "复印件",
        "options": [
            "poto",
            "photo",
            "phôto",
            "phôto"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 18.57,
        "end": 19.79,
        "correctAnswer": "hộ chiếu",
        "translation": "护照",
        "options": [
            "hô chiếu",
            "hộ chiểu",
            "hộ chiếu",
            "hô chíu"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 19.93,
        "end": 20.85,
        "correctAnswer": "ảnh",
        "translation": "照片",
        "options": [
            "anh",
            "ảnh",
            "ãnh",
            "ảnh"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 21.08,
        "end": 21.96,
        "correctAnswer": "cỡ",
        "translation": "尺寸",
        "options": [
            "cỡ",
            "cơ",
            "cở",
            "cưỡ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 22.13,
        "end": 23.17,
        "correctAnswer": "đơn",
        "translation": "申请表",
        "options": [
            "đơ",
            "đon",
            "đơn",
            "đoăn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 23.21,
        "end": 24.61,
        "correctAnswer": "xin visa",
        "translation": "申请签证",
        "options": [
            "xinv isa",
            "xin vsia",
            "xin visa",
            "xin visaa"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 24.69,
        "end": 25.82,
        "correctAnswer": "xin học",
        "translation": "申请学习",
        "options": [
            "xin học",
            "xin hộc",
            "xinh ọc",
            "xin hoc"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 25.9,
        "end": 27.08,
        "correctAnswer": "lưu ý",
        "translation": "注意[留意]",
        "options": [
            "lưu y",
            "lưu ý",
            "liu ý",
            "lưu i"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 27.18,
        "end": 28.28,
        "correctAnswer": "thời hạn",
        "translation": "期限",
        "options": [
            "thời hạn",
            "thòi hạn",
            "thời hản",
            "thời hàn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 28.42,
        "end": 29.49,
        "correctAnswer": "ít nhất",
        "translation": "至少",
        "options": [
            "ít nhấc",
            "ít nhất",
            "ịt nhất",
            "ít nhấtt"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 29.58,
        "end": 30.73,
        "correctAnswer": "trước đây",
        "translation": "之前",
        "options": [
            "trước đơy",
            "trươk đơy",
            "trướk đây",
            "trước đây"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 30.8,
        "end": 31.89,
        "correctAnswer": "thời điểm",
        "translation": "时间点, 时机, 时候",
        "options": [
            "thơi điểm",
            "thời diểm",
            "thời điểm",
            "thời điếm"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 32.02,
        "end": 33.1,
        "correctAnswer": "dự định",
        "translation": "预计",
        "options": [
            "dự đinh",
            "dự định",
            "dụ định",
            "dự dịnh"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 33.24,
        "end": 34.24,
        "correctAnswer": "đến",
        "translation": "到达",
        "options": [
            "đen",
            "đến",
            "đấn",
            "đền"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 34.33,
        "end": 35.5,
        "correctAnswer": "hồ sơ",
        "translation": "档案",
        "options": [
            "hồ sô",
            "hồ sơ",
            "hô sơ",
            "hồ sờ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 35.64,
        "end": 37.1,
        "correctAnswer": "Cục Xuất nhập cảnh",
        "translation": "出入境管理局",
        "options": [
            "Cục Xuất nhập cảnh",
            "Cục Xuấc nhập cảnh",
            "Cục Xuất nhâp cảnh",
            "Cụk Xuất nhập cảnh"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 37.25,
        "end": 38.45,
        "correctAnswer": "đồng ý",
        "translation": "同意",
        "options": [
            "đồng ý",
            "đòng ý",
            "đong ý",
            "đồng i"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 38.52,
        "end": 39.66,
        "correctAnswer": "thông tin",
        "translation": "信息",
        "options": [
            "thông tiên",
            "thông tin",
            "thồng tin",
            "thông tinn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 39.82,
        "end": 41.03,
        "correctAnswer": "Sứ quán",
        "translation": "使馆",
        "options": [
            "Sứ quàn",
            "Sứ quản",
            "Sứ quán",
            "Sứ quân"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 41.15,
        "end": 42.2,
        "correctAnswer": "mang",
        "translation": "携带",
        "options": [
            "mang",
            "mangg",
            "măng",
            "maang"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 42.32,
        "end": 43.53,
        "correctAnswer": "đăng ký",
        "translation": "登记",
        "options": [
            "đăng ky",
            "đằng ký",
            "đăng ký",
            "đăng kị"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 43.68,
        "end": 44.61,
        "correctAnswer": "nhận",
        "translation": "领取",
        "options": [
            "nhận",
            "nhẫn",
            "nhậnn",
            "nhăn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 44.83,
        "end": 45.75,
        "correctAnswer": "tự",
        "translation": "自己",
        "options": [
            "tữ",
            "tư",
            "tự",
            "tị"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 45.96,
        "end": 46.92,
        "correctAnswer": "tìm",
        "translation": "寻找",
        "options": [
            "tím",
            "tim",
            "tìm",
            "tìmm"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 47.12,
        "end": 48.25,
        "correctAnswer": "chỗ ở",
        "translation": "住宿",
        "options": [
            "chỗ ỡ",
            "chô ở",
            "chỗ ở",
            "chỗơ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 48.37,
        "end": 49.46,
        "correctAnswer": "nhờ",
        "translation": "托, 拜托",
        "options": [
            "nhờ",
            "nhơ",
            "nhở",
            "nhờr"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 49.54,
        "end": 50.67,
        "correctAnswer": "bạn bè",
        "translation": "朋友",
        "options": [
            "bạn bề",
            "bạng bè",
            "bạn bè",
            "bặn bè"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 50.86,
        "end": 51.96,
        "correctAnswer": "hỗ trợ",
        "translation": "帮助-[互助]",
        "options": [
            "hỗ trọ",
            "hổ trợ",
            "hỗ trợ",
            "hổ trọ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 52.16,
        "end": 53.07,
        "correctAnswer": "việc",
        "translation": "事情",
        "options": [
            "viêc",
            "việc",
            "viếc",
            "việt"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 53.19,
        "end": 54.36,
        "correctAnswer": "còn lại",
        "translation": "剩下",
        "options": [
            "còn lai",
            "cón lại",
            "còn lại",
            "cỏn lại"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 54.48,
        "end": 55.57,
        "correctAnswer": "chuẩn bị",
        "translation": "准备",
        "options": [
            "chuản bị",
            "chuẩn bĩ",
            "chuẩn bị",
            "chuẫn bị"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 55.8,
        "end": 57.07,
        "correctAnswer": "mọi thứ",
        "translation": "一切",
        "options": [
            "mợi thứ",
            "mọi thứ",
            "mọi thừ",
            "mọithứ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 57.09,
        "end": 58.2,
        "correctAnswer": "cần thiết",
        "translation": "必要",
        "options": [
            "cần thiết",
            "cấn thiết",
            "cần thiệt",
            "cần thiếc"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 58.32,
        "end": 59.45,
        "correctAnswer": "sinh sống",
        "translation": "生活",
        "options": [
            "sinh sồng",
            "sinh sóng",
            "sinh sống",
            "sinh xống"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 59.65,
        "end": 60.72,
        "correctAnswer": "hy vọng",
        "translation": "希望",
        "options": [
            "hy vọng",
            "hy võng",
            "hi vọng",
            "hy vong"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 60.88,
        "end": 61.76,
        "correctAnswer": "gặp",
        "translation": "遇到",
        "options": [
            "gập",
            "gặp",
            "gắp",
            "gạp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 61.97,
        "end": 63.07,
        "correctAnswer": "thuận lợi",
        "translation": "顺利",
        "options": [
            "thuận lơi",
            "thuân lợi",
            "thuận lợi",
            "thuận lỏi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 63.25,
        "end": 64.37,
        "correctAnswer": "chuyến đi",
        "translation": "旅程",
        "options": [
            "chuyến đi",
            "chuyễn đi",
            "chuyến đị",
            "chuyềnn đi"
        ]
    }
];

        // Xử lý hiển thị văn bản với từ điển
        const content = document.getElementById('content');
        function renderText() {
            let html = textContentData[0].replace(/\n/g, "<br>");
            const sortedKeys = Object.keys(dictionary).sort((a, b) => b.length - a.length);
            const replacements = [];

            sortedKeys.forEach(key => {
                const regex = new RegExp(`(\\b|[.,!?\\n\\s]|^)(${key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})(\\b|[.,!?\\n\\s]|$)`, 'gi');
                let match;
                while ((match = regex.exec(html)) !== null) {
                    const start = match.index + match[1].length;
                    const end = start + match[2].length;
                    replacements.push({
                        start,
                        end,
                        original: match[2],
                        prefix: match[1],
                        suffix: match[3],
                        translation: dictionary[key]
                    });
                }
            });

            replacements.sort((a, b) => a.start - b.start);
            const filteredReplacements = [];
            let lastEnd = -1;
            for (const replacement of replacements) {
                if (replacement.start >= lastEnd) {
                    filteredReplacements.push(replacement);
                    lastEnd = replacement.end;
                }
            }

            for (let i = filteredReplacements.length - 1; i >= 0; i--) {
                const { start, end, original, prefix, suffix, translation } = filteredReplacements[i];
                const translatedHtml = `${prefix}<span class="translated-word"><span class="translation">${translation}</span><span class="original">${original}</span></span>${suffix}`;
                html = html.slice(0, start - prefix.length) + translatedHtml + html.slice(end + suffix.length);
            }

            content.innerHTML = html;
        }

        // Xử lý hiển thị ảnh
        const imageFrame = document.getElementById('imageFrame');
        const contentImage = document.getElementById('contentImage');
        const imageSrc = "anhminhhoa.jpg";
        function renderImage() {
            if (imageSrc) {
                contentImage.src = imageSrc;
                imageFrame.style.display = 'block';
            } else {
                imageFrame.style.display = 'none';
            }
        }

        // Xử lý audio và bảng điều khiển
        const audioPlayer = document.getElementById("audioPlayer");
        const floatingControls = document.getElementById("floatingControls");
        if (!floatingControls) {
            console.error('Không tìm thấy floatingControls');
        }
        const timeDisplay = floatingControls ? floatingControls.querySelector("#timeDisplay") : null;
        const loopStart = floatingControls ? floatingControls.querySelector("#loopStart") : null;
        const loopEnd = floatingControls ? floatingControls.querySelector("#loopEnd") : null;
        const loopButton = floatingControls ? floatingControls.querySelector("#loopButton") : null;
        const clearButton = floatingControls ? floatingControls.querySelector("#clearButton") : null;
        const rewind5sButton = floatingControls ? floatingControls.querySelector("#rewind5sButton") : null;
        const rewind1sButton = floatingControls ? floatingControls.querySelector("#rewind1sButton") : null;
        const forward1sButton = floatingControls ? floatingControls.querySelector("#forward1sButton") : null;
        const forward5sButton = floatingControls ? floatingControls.querySelector("#forward5sButton") : null;
        const pausePlayButton = floatingControls ? floatingControls.querySelector("#pausePlayButton") : null;
        const toggleControlsButton = floatingControls ? floatingControls.querySelector("#toggleControlsButton") : null;
        const tuaButtons = floatingControls ? floatingControls.querySelector(".tua-buttons") : null;

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay(displayElement) {
            if (displayElement) {
                displayElement.textContent = formatTime(audioPlayer.currentTime);
            }
        }

        let customLoopStart = null;
        let customLoopEnd = null;
        let clickCount = 0;
        let isLooping = false;

        if (timeDisplay) {
            const updateInterval = setInterval(() => updateTimeDisplay(timeDisplay), 1000);
            timeDisplay.onclick = () => {
                if (audioPlayer.paused) {
                    clickCount++;
                    if (clickCount === 1) {
                        customLoopStart = audioPlayer.currentTime;
                        loopStart.textContent = formatTime(customLoopStart);
                    } else if (clickCount === 2) {
                        customLoopEnd = audioPlayer.currentTime;
                        if (customLoopEnd <= customLoopStart) {
                            customLoopEnd = null;
                            loopEnd.textContent = "--:--";
                        } else {
                            loopEnd.textContent = formatTime(customLoopEnd);
                        }
                        clickCount = 0;
                    }
                }
            };
        }

        if (audioPlayer) {
            audioPlayer.ontimeupdate = function() {
                updateTimeDisplay(timeDisplay);
                if (isLooping && customLoopStart !== null && customLoopEnd !== null) {
                    if (audioPlayer.currentTime >= customLoopEnd) {
                        audioPlayer.currentTime = customLoopStart;
                    }
                }
            };
        }

        if (rewind5sButton) {
            rewind5sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 5);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (rewind1sButton) {
            rewind1sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 1);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (forward1sButton) {
            forward1sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 1);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (forward5sButton) {
            forward5sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 5);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }

        if (pausePlayButton) {
            pausePlayButton.onclick = () => {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    pausePlayButton.textContent = "停";
                } else {
                    audioPlayer.pause();
                    pausePlayButton.textContent = "播";
                }
            };
        }

        if (loopButton) {
            loopButton.onclick = () => {
                if (customLoopStart !== null && customLoopEnd !== null) {
                    audioPlayer.currentTime = customLoopStart;
                    audioPlayer.play();
                    isLooping = true;
                    if (rewind5sButton) rewind5sButton.disabled = true;
                    if (rewind1sButton) rewind1sButton.disabled = true;
                    if (forward1sButton) forward1sButton.disabled = true;
                    if (forward5sButton) forward5sButton.disabled = true;
                }
            };
        }

        if (clearButton) {
            clearButton.onclick = () => {
                customLoopStart = null;
                customLoopEnd = null;
                if (loopStart) loopStart.textContent = "--:--";
                if (loopEnd) loopEnd.textContent = "--:--";
                clickCount = 0;
                isLooping = false;
                if (rewind5sButton) rewind5sButton.disabled = false;
                if (rewind1sButton) rewind1sButton.disabled = false;
                if (forward1sButton) forward1sButton.disabled = false;
                if (forward5sButton) forward5sButton.disabled = false;
            };
        }

        let controlsVisible = true;
        if (toggleControlsButton) {
            toggleControlsButton.onclick = () => {
                if (controlsVisible) {
                    if (timeDisplay) timeDisplay.style.display = "none";
                    if (tuaButtons) tuaButtons.style.display = "none";
                    if (pausePlayButton) pausePlayButton.style.display = "none";
                    if (loopStart) loopStart.style.display = "none";
                    if (loopEnd) loopEnd.style.display = "none";
                    if (loopButton) loopButton.style.display = "none";
                    if (clearButton) clearButton.style.display = "none";
                    toggleControlsButton.textContent = "示";
                    controlsVisible = false;
                } else {
                    if (timeDisplay) timeDisplay.style.display = "inline-block";
                    if (tuaButtons) tuaButtons.style.display = "flex";
                    if (pausePlayButton) pausePlayButton.style.display = "inline-flex";
                    if (loopStart) loopStart.style.display = "inline-block";
                    if (loopEnd) loopEnd.style.display = "inline-block";
                    if (loopButton) loopButton.style.display = "inline-flex";
                    if (clearButton) clearButton.style.display = "inline-flex";
                    toggleControlsButton.textContent = "藏";
                    controlsVisible = true;
                }
            };
        }

        if (audioPlayer) {
            audioPlayer.onpause = audioPlayer.onended = function() {
                if (pausePlayButton) pausePlayButton.textContent = "播";
            };
        }

        // Xử lý chế độ từ vựng
        const vocabAudio = document.getElementById('vocabAudio');
        const correctAudio = document.getElementById('correctAudio');
        const wrongAudio = document.getElementById('wrongAudio');
        const vocabIndicator = document.getElementById('vocabIndicator');
        const sentenceNumber = document.getElementById('sentenceNumber');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const replayBtn = document.getElementById('replayBtn');
        const showHideBtn = document.getElementById('showHideBtn');
        const vocabOptionsContainer = document.getElementById('vocabOptionsContainer');

        let currentIndex = 0;
        let showAnswer = true;
        let isPlaying = false;

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function updateVocabDisplay() {
            if (sentenceNumber) sentenceNumber.value = currentIndex + 1;
            if (vocabIndicator) {
                vocabIndicator.style.background = '#ffffe0';
                vocabIndicator.innerHTML = showAnswer ? `
                    <div style="font-size: 20px; font-weight: normal; color: #38761d;">${sentences[currentIndex].translation}</div>
                ` : '';
            }
            updateVocabOptions();
            playCurrentSentence();
        }

        function updateVocabOptions() {
            if (vocabOptionsContainer) {
                vocabOptionsContainer.innerHTML = '';
                const shuffledOptions = shuffleArray(sentences[currentIndex].options);
                shuffledOptions.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'optionBtn';
                    btn.textContent = option;
                    btn.onclick = () => checkVocabAnswer(option);
                    vocabOptionsContainer.appendChild(btn);
                });
            }
        }

        function playCurrentSentence() {
            if (isPlaying) vocabAudio.pause();
            [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.add('disabled'));
            if (sentenceNumber) sentenceNumber.disabled = true;
            isPlaying = true;
            vocabAudio.src = sentences[currentIndex].audioFile;
            vocabAudio.currentTime = sentences[currentIndex].start;
            vocabAudio.play().catch(error => {
                console.error('Audio playback failed:', error);
                alert('Vui lòng nhấn nút “再听一遍” để phát âm thanh.');
                [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.remove('disabled'));
                if (sentenceNumber) sentenceNumber.disabled = false;
                isPlaying = false;
            });

            vocabAudio.ontimeupdate = () => {
                if (vocabAudio.currentTime >= sentences[currentIndex].end) {
                    vocabAudio.pause();
                    vocabAudio.ontimeupdate = null;
                    [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.remove('disabled'));
                    if (sentenceNumber) sentenceNumber.disabled = false;
                    isPlaying = false;
                }
            };
        }

        function moveSentence(direction) {
            currentIndex = (currentIndex + direction + sentences.length) % sentences.length;
            updateVocabDisplay();
        }

        function checkVocabAnswer(selectedAnswer) {
            const correctAnswer = sentences[currentIndex].correctAnswer;
            const optionButtons = vocabOptionsContainer.getElementsByClassName('optionBtn');

            for (let btn of optionButtons) {
                btn.classList.remove('correct', 'wrong');
                if (btn.textContent === selectedAnswer) {
                    if (selectedAnswer === correctAnswer) {
                        vocabIndicator.style.background = '#B7D7AA';
                        btn.classList.add('correct');
                        correctAudio.play().catch(error => console.error('Correct audio playback failed:', error));
                        correctAudio.onended = () => {
                            setTimeout(() => moveSentence(1), 200);
                        };
                    } else {
                        vocabIndicator.style.background = '#CE6D5E';
                        btn.classList.add('wrong');
                        wrongAudio.play().catch(error => console.error('Wrong audio playback failed:', error));
                        wrongAudio.onended = null;
                    }
                }
            }
        }

        if (prevBtn) {
            prevBtn.onclick = () => {
                if (!isPlaying) moveSentence(-1);
            };
        }

        if (nextBtn) {
            nextBtn.onclick = () => {
                if (!isPlaying) moveSentence(1);
            };
        }

        if (replayBtn) {
            replayBtn.onclick = () => {
                if (!isPlaying) playCurrentSentence();
            };
        }

        if (showHideBtn) {
            showHideBtn.onclick = () => {
                if (!isPlaying) {
                    showAnswer = !showAnswer;
                    showHideBtn.classList.toggle('active-mode');
                    updateVocabDisplay();
                }
            };
        }

        if (sentenceNumber) {
            sentenceNumber.onchange = () => {
                if (!isPlaying) {
                    const num = parseInt(sentenceNumber.value) - 1;
                    if (!isNaN(num) && num >= 0 && num < sentences.length) {
                        currentIndex = num;
                        updateVocabDisplay();
                    } else {
                        alert(`输入范围： 1 到 ${sentences.length}`);
                        updateVocabDisplay();
                    }
                }
            };

            sentenceNumber.onkeydown = (e) => {
                if (!isPlaying) {
                    if (e.key === 'ArrowLeft') moveSentence(-1);
                    if (e.key === 'ArrowRight') moveSentence(1);
                }
            };
        }

        function initVocab() {
            currentIndex = 0;
            showAnswer = true;
            isPlaying = false;
            updateVocabDisplay();
        }

        // Xử lý câu hỏi
        let contentScrollPosition = 0;
        let quizScrollPosition = 0;
        let vocabScrollPosition = 0;
        let userSelections = {};
        let isSubmitted = false;

        function loadQuiz() {
            const questionsDiv = document.getElementById('questions');
            if (questionsDiv) {
                questionsDiv.innerHTML = '';
                quizData.forEach((item, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question';
                    const questionTitle = document.createElement('h3');
                    questionTitle.textContent = `Câu ${index + 1}: ${item.question}`;
                    questionDiv.appendChild(questionTitle);

                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'options';
                    item.options.forEach(option => {
                        const label = document.createElement('label');
                        const isChecked = userSelections[`question${index}`] === option ? 'checked' : '';
                        label.innerHTML = `
                            <input type="radio" name="question${index}" value="${option}" ${isChecked}>
                            ${option}
                        `;
                        optionsDiv.appendChild(label);
                    });

                    questionDiv.appendChild(optionsDiv);
                    questionsDiv.appendChild(questionDiv);
                });
                window.scrollTo(0, quizScrollPosition);
            }
        }

        function saveSelections() {
            quizData.forEach((_, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    userSelections[`question${index}`] = selected.value;
                }
            });
        }

        function checkAnswers() {
            let score = 0;
            const total = quizData.length;
            let wrongAnswers = [];
            quizData.forEach((item, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    if (selected.value === item.correct) {
                        score++;
                    } else {
                        wrongAnswers.push({
                            question: item.question,
                            selected: selected.value,
                            correct: item.correct
                        });
                    }
                } else {
                    wrongAnswers.push({
                        question: item.question,
                        selected: "未选择",
                        correct: item.correct
                    });
                }
            });

            const resultDiv = document.getElementById('result');
            if (resultDiv) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <h3>YD-Visa-结果: ${score}/${total} 答案正确</h3>
                    <p>比例: ${(score/total * 100).toFixed(2)}%</p>
                `;
                if (wrongAnswers.length > 0) {
                    resultDiv.innerHTML += '<h4>错误答案:</h4>';
                    wrongAnswers.forEach((wrong, index) => {
                        resultDiv.innerHTML += `
                            <div class="wrong-answer">
                                Câu ${quizData.findIndex(q => q.question === wrong.question) + 1}: ${wrong.question}<br>
                                你的选择: ${wrong.selected} - 正确答案: ${wrong.correct}
                            </div>
                        `;
                    });
                } else {
                    resultDiv.innerHTML += '<p>回答正确所有问题</p>';
                }
                resultDiv.scrollIntoView({ behavior: 'smooth' });
                isSubmitted = true;
            }
        }

        // Xử lý chế độ hiển thị
        const contentModeButton = document.getElementById('contentMode');
        const quizModeButton = document.getElementById('quizMode');
        const vocabModeButton = document.getElementById('vocabMode');
        const contentContainer = document.getElementById('contentContainer');
        const quizContainer = document.getElementById('quizContainer');
        const vocabContainer = document.getElementById('vocabContainer');
        const vocabControls = document.getElementById('vocabControls');

        if (contentModeButton) {
            contentModeButton.addEventListener('click', () => {
                quizScrollPosition = window.scrollY;
                vocabScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'block';
                quizContainer.style.display = 'none';
                vocabContainer.style.display = 'none';
                vocabControls.style.display = 'none';
                contentModeButton.classList.add('active');
                quizModeButton.classList.remove('active');
                vocabModeButton.classList.remove('active');
                floatingControls.style.display = 'block';
                renderText();
                renderImage();
                window.scrollTo(0, contentScrollPosition);
            });
        }

        if (quizModeButton) {
            quizModeButton.addEventListener('click', () => {
                contentScrollPosition = window.scrollY;
                vocabScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'none';
                quizContainer.style.display = 'block';
                vocabContainer.style.display = 'none';
                vocabControls.style.display = 'none';
                quizModeButton.classList.add('active');
                contentModeButton.classList.remove('active');
                vocabModeButton.classList.remove('active');
                floatingControls.style.display = 'none';
                if (isSubmitted) {
                    userSelections = {};
                    isSubmitted = false;
                }
                loadQuiz();
            });
        }

        if (vocabModeButton) {
            vocabModeButton.addEventListener('click', () => {
                contentScrollPosition = window.scrollY;
                quizScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'none';
                quizContainer.style.display = 'none';
                vocabContainer.style.display = 'block';
                vocabControls.style.display = 'block';
                vocabModeButton.classList.add('active');
                contentModeButton.classList.remove('active');
                quizModeButton.classList.remove('active');
                floatingControls.style.display = 'none';
                initVocab();
                window.scrollTo(0, vocabScrollPosition);
            });
        }

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', () => {
            renderText();
            renderImage();
            contentContainer.style.display = 'block';
            quizContainer.style.display = 'none';
            vocabContainer.style.display = 'none';
            vocabControls.style.display = 'none';
        });
    </script>
</body>
</html>
